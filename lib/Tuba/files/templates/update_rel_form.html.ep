% layout 'default';
<center>
<h2><%= $object->stringify %></h2>
</center>

% my $controls = stash 'controls' || {};

<div class='row-fluid'>

%= include 'update_tabs', active => 'rel';

<div class='tab-content'>

%= include 'relationships', object => $object, meta => $meta;

%= form_for 'update_rel_'.$meta->table => class => 'form-horizontal well' => begin
% if (my $error = (stash 'error')) {
    <div class='alert alert-error'><%= $error %></div>
% }
% if (my $info = (stash 'info')) {
    <div class='alert alert-success'><b><%= $info %></b></div>
% }

% for my $rel (@{ (stash 'relationships') || $meta->relationships }) {
<div class='control-group' style='margin:10px;'>
<label class='control-label'>
%= $rel->name
</label>

<div class="controls">
    % if (my $entry = $controls->{$rel->name}) {
        % $entry = $self->$entry($object) if ref($entry) eq 'CODE';
        %= include 'controls/'.$entry->{template}, object => $object, %{ $entry->{params} || {} };
    % } else {
    <span class='alert alert-danger'>not implemented</span>
    % }
</div>
</div>
% }

<div class="form-actions">
    <button type="submit" class="btn btn-primary">Save changes</button>
    <button type="reset" class="btn">Reset</button>
</div>

%= end

</div>
</div>

